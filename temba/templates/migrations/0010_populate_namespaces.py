# Generated by Django 2.2.20 on 2021-05-10 14:33

from django.db import migrations


def populate_namespaces(apps, schema_editor):
    TemplateTranslation = apps.get_model("templates", "TemplateTranslation")
    Channel = apps.get_model("channels", "Channel")

    channels = Channel.objects.filter(channel_type="WA")
    for channel in channels:
        namespace = channel.config["fb_namespace"]
        translation_ids = channel.translations.values_list("id", flat=True)
        TemplateTranslation.objects.filter(id__in=translation_ids).update(namespace=namespace)


def reverse(apps, schema_editor):
    pass


class Migration(migrations.Migration):

    dependencies = [
        ("templates", "0009_templatetranslation_namespace"),
    ]

    operations = [migrations.RunPython(populate_namespaces, reverse)]
