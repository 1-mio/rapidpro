-extends "smartmin/list.html"
-load smartmin i18n contacts compress

-block page-title
  {{ title }}

-block page-top

-block content
  #pjax
    -block pjax

      .lp-frame
        .left
          .flex.flex-col
            .lp-nav.upper
              .lp-nav-item(class="{% if folder == 'open' %}font-normal{% endif %}")
                .name(onclick="goto(event)" href="{% url 'tickets.ticket_open' %}")
                  -trans "Open"
              .lp-nav-item(class="{% if folder == 'closed' %}font-normal{% endif %}")
                .name(onclick="goto(event)" href="{% url 'tickets.ticket_open' %}")
                  -trans "Closed"

            -if ticketers
              .lp-nav.lower
                .font-normal.uppercase.text-xs.text-gray-500.pb-1
                  -trans "Services"
                .inner-scroll
                  -for t in ticketers
                    .lp-nav-item(class="{% if ticketer == t %}font-normal{% endif %}")
                      .name(onclick="goto(event)" href="{% url 'tickets.ticket_filter' t.uuid %}}")
                        {{ t.name }}

        .right
          .flex.w-full.items-end.mb-4
            -block action-buttons
              -if org_perms.tickets.ticket_update
                .action-buttons.list-buttons-container.h-full.mr-2.flex-grow
                  .list-buttons.flex.items-center.-mx-2.h-full
                    -if 'close' in actions
                      .button-action.object-btn-close
                        .glyph.icon-box
                        -trans "Close"

                    -if 'reopen' in actions
                      .button-action.object-btn-close
                        .glyph.icon-box
                        -trans "Reopen"

            .flex-grow.ml-2.items-center
              -block title-text
                .page-title.leading-tight
                  {{ title }}

          %table.list.object-list.lined{class: '{% if tickets.ticket_update %}selectable{% endif %}'}
            %tbody
              -for object in object_list
                %tr.ticket.object-row.select-row{ data-object-id: "{{ obj.id }}"}
                  -if actions and org_perms.tickets.ticket_update
                    %td.campaign.checkbox.object-row-checkbox
                      .glyph.icon-checkbox-unchecked.flow-checkbox.object-row-checkbox
                  %td.whitespace-no-wrap
                    .hover-linked{onclick:"goto(event)", href:"/contact/read/{{object.contact.uuid}}/"}
                      {{ object.contact|short_name:user_org }}
                  -if not ticketer
                    %td.ticket-ticketer
                      -if object.ticketer.is_active
                        %a(href="{% url 'tickets.ticket_filter' object.ticketer.uuid %}")
                          {{ object.ticketer.name }}
                      -else
                        %span.ticketer-inactive
                          {{ object.ticketer.name }}
                  %td.ticket-subject
                    {{ object.subject }}
                  %td.ticket-body
                    {{ object.body }}
                  -if not folder
                    %td.ticket-status
                      %span.label(class="status-{{object.status}}")
                        {{ object.get_status_display }}
                  %td.opened_on
                    %span.time
                      {% short_datetime object.opened_on %}

              -empty
                %tr.empty
                  %td(colspan=5)
                    -trans "No tickets."

          .flex.flex-col.mx-4.mt-3.mb-16
            .flex.flex-wrap
              .text-gray-700
                -include "includes/results_count.html"
              .flex-grow
                -include "includes/pages.html"


-block extra-script
  {{ block.super }}

  :javascript
    $('.select-row').live('mouseover', function(){
      var contactPageUrl = '/contact/read/' + $(this).data('contact-uuid');

      $(this).find('td').not('.checkbox').each(function(){
        $(this).on('click', function() {
          document.location.href = contactPageUrl;
        });
      });
    });


-block extra-style
  {{ block.super }}

  :css
    td.opened_on {
      text-align: right;
    }

    .ticketer-inactive {
      color: #AAA;
    }


-block extra-less
  -compress css inline
    {% lessblock %}
      :plain
        .label.status-O {
          border: 1px solid @flat-mutedgreen - #333;
          background-color: @flat-mutedgreen - #222;
        }
        .label.status-C {
          border: 1px solid @flat-darkred - #111;
          background-color: @flat-darkred;
        }
    {% endlessblock %}