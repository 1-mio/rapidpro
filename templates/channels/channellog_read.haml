{% extends "smartmin/read.html" %}
-load i18n compress

-block page-title
  -trans "Channel Event"

-block page-top

-block above-bar
  %a.btn.btn-secondary{ href: '{% url "channels.channellog_list" object.channel.uuid %}' } Message Log

-block content
  #pjax
    -block pjax
      .lp-frame

        .right
          .flex.w-full.mb-4.items-end.flex-wrap.justify-end.-mt-2{style:"min-height:41px"}
            .flex-grow.ml-1.self-end.items-end
              .flex.flex-col.pr-12
                .page-title.leading-tight
                  -block title
                    -if object.is_error
                      -trans "Message Error"
                    -else
                      -if object.connection_type
                        -trans "Call Log"
                      -else
                        -trans "Message Log"

                    -if request.GET.connections and channel.supports_ivr
                      -trans "Calls"
                    -elif request.GET.others
                      -trans "Other Interactions"
                    -else
                      -trans "Recent Channel Events"
                .subtitle
                  Provider: {{ object.channel.get_channel_type_display }}

  .card.flex
    .inline-flex.mr-8
      .font-bold.mr-2
        -trans "Recipient"
      -if object.msg
        %a{href:'{% url "contacts.contact_read" object.msg.contact.uuid %}'}
          {{object.msg.contact_urn.get_display}}
      -elif object.connection_type
        %a{href:'{% url "contacts.contact_read" object.contact.uuid %}'}
          {{object.contact_urn.path}}

    .inline-flex.mr-8
      .font-bold.mr-2
        -trans ""
          Channel
      %a{href:'{% url "channels.channel_read" object.channel.uuid %}'}
        {{object.channel}}

    .inline-flex.mr-8
      .font-bold.mr-2
        -trans "Direction"
      -if object.connection_type
        {{object.get_direction_display}}
      -else
        {{object.msg.get_direction_display}}

    .inline-flex.mr-8
      .font-bold.mr-2
        -trans "Date"
      {{object.created_on|date:"M j, Y g:i:s a"}}

    -if object.duration
      .inline-flex.mr-8
        .font-bold.mr-2
          -trans "Duration"
        {{object.get_duration|delta}}

    .inline-flex.mr-8
      .font-bold.mr-2
        -trans "Status"
      -if object.connection_type
        {{object.get_status_display}}
      -else
        -if object.is_error
          -trans "Error"
        -else
          {{object.msg.get_status_display}}

  -if object.connection_type
    -for log in object.channel_logs.all
      -include "channels/channellog_log.haml"
  -else
    -for log in object.log_group
      -include "channels/channellog_log.haml"

-block extra-script
  {{ block.super }}
  <script src="{{ STATIC_URL }}rest_framework/js/prettify-min.js"></script>
  :javascript
    $(function(){
      prettyPrint();
    });

  :javascript
    $('document').ready(function(){
      $('.summary :first').click();
    });

    $('.summary').on('click', function() {
      var top = $(this).parent('.log')
      var ele = top.find(".details");
      if (ele.is(':visible')) {
        ele.slideUp();
        top.removeClass('expanded');
      } else {
        ele.slideDown();
        top.addClass('expanded')
      }
    });

-block extra-style
  {{ block.super }}
  <link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}rest_framework/css/prettify.css"/>
  :css
    .page-content {
      max-width: 100%;
    }

-block extra-less
  {{block.super}}
  -compress css inline
    {% lessblock %}
      :plain
        pre.prettyprint {
          margin: 0;
          border: 0;
          max-height: none !important;

          &.request {
            background: #f7f7f9 + 111;
          }
        }
    {% endlessblock %}
